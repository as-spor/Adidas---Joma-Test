<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>As Spor - Pro Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: '#0f172a',
                        card: '#1e293b',
                        primary: '#fbbf24', // Amber-400
                        accent: '#3b82f6', // Blue-500
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <style>
        body { background-color: #0f172a; color: #e2e8f0; }
        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .hover-card { transition: all 0.3s ease; }
        .hover-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 10px 30px -10px rgba(251, 191, 36, 0.15);
            border-color: rgba(251, 191, 36, 0.3);
        }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #fbbf24; }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px #10b981; }
            50% { box-shadow: 0 0 15px #10b981; }
        }
        .live-indicator { animation: pulse-glow 2s infinite; }
    </style>
</head>
<body class="antialiased selection:bg-primary selection:text-dark">

    <div class="fixed left-0 top-0 h-full w-20 bg-dark border-r border-gray-800 flex flex-col items-center py-6 z-50 hidden md:flex">
        <div class="mb-10 text-primary text-3xl font-black tracking-tighter cursor-pointer">AS</div>
        <div class="flex flex-col space-y-8 w-full">
            <a href="#" class="h-12 w-full border-r-4 border-primary bg-white/5 flex items-center justify-center text-primary transition"><i class="fa-solid fa-chart-pie text-xl"></i></a>
            <a href="#" class="h-12 w-full border-r-4 border-transparent hover:text-primary text-gray-400 flex items-center justify-center transition"><i class="fa-solid fa-users text-xl"></i></a>
            <a href="#" class="h-12 w-full border-r-4 border-transparent hover:text-primary text-gray-400 flex items-center justify-center transition"><i class="fa-solid fa-box-open text-xl"></i></a>
        </div>
        <div class="mt-auto">
            <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-primary to-yellow-600 flex items-center justify-center font-bold text-dark text-sm cursor-pointer hover:scale-110 transition">AY</div>
        </div>
    </div>

    <div class="md:hidden flex justify-between items-center p-4 bg-card border-b border-gray-800">
        <div class="text-primary font-black text-xl">AS SPOR</div>
        <i class="fa-solid fa-bars text-white text-xl"></i>
    </div>

    <div class="md:ml-20 p-4 md:p-8 lg:p-10 min-h-screen relative overflow-hidden">
        
        <div class="absolute top-0 left-0 w-96 h-96 bg-primary/10 rounded-full filter blur-[100px] -z-10"></div>
        <div class="absolute bottom-0 right-0 w-96 h-96 bg-blue-500/10 rounded-full filter blur-[100px] -z-10"></div>

        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-4">
            <div>
                <h1 id="welcomeText" class="text-3xl font-bold text-white mb-1">Veriler Y√ºkleniyor...</h1>
                <p class="text-gray-400 text-sm">Anlƒ±k satƒ±≈ü verilerin sistemden √ßekiliyor.</p>
            </div>
            
            <div class="glass rounded-xl p-1.5 flex items-center gap-2 shadow-2xl">
                <div class="flex items-center gap-2 px-3 py-1 bg-green-500/10 border border-green-500/30 rounded-lg ml-2">
                    <div class="w-2 h-2 rounded-full bg-green-500 live-indicator"></div>
                    <span class="text-green-500 text-xs font-bold tracking-wider">CANLI Sƒ∞STEM</span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="glass rounded-2xl p-6 hover-card border-l-4 border-primary">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-400 text-xs font-semibold uppercase tracking-wider">Toplam √úr√ºn</p>
                        <h3 id="kpiTotalItems" class="text-3xl font-bold text-white mt-1">0</h3>
                    </div>
                    <div class="w-10 h-10 rounded-lg bg-primary/20 flex items-center justify-center text-primary">
                        <i class="fa-solid fa-layer-group"></i>
                    </div>
                </div>
            </div>

            <div class="glass rounded-2xl p-6 hover-card border-l-4 border-blue-500">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-400 text-xs font-semibold uppercase tracking-wider">Ayakkabƒ± Satƒ±≈ü</p>
                        <h3 id="kpiShoes" class="text-3xl font-bold text-white mt-1">0</h3>
                    </div>
                    <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center text-blue-400">
                        <i class="fa-solid fa-shoe-prints"></i>
                    </div>
                </div>
            </div>

            <div class="glass rounded-2xl p-6 hover-card border-l-4 border-purple-500">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-400 text-xs font-semibold uppercase tracking-wider">Tekstil Satƒ±≈ü</p>
                        <h3 id="kpiTextile" class="text-3xl font-bold text-white mt-1">0</h3>
                    </div>
                    <div class="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center text-purple-400">
                        <i class="fa-solid fa-shirt"></i>
                    </div>
                </div>
            </div>

             <div class="glass rounded-2xl p-6 hover-card border-l-4 border-pink-500">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-400 text-xs font-semibold uppercase tracking-wider">Aksesuar Satƒ±≈ü</p>
                        <h3 id="kpiAccessory" class="text-3xl font-bold text-white mt-1">0</h3>
                    </div>
                    <div class="w-10 h-10 rounded-lg bg-pink-500/20 flex items-center justify-center text-pink-400">
                        <i class="fa-solid fa-socks"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            
            <div class="glass rounded-2xl p-6 lg:col-span-2">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold text-white">Performans √ñzeti</h3>
                    <span class="text-xs text-gray-500">Haftalƒ±k Trend</span>
                </div>
                <div class="relative h-72 w-full">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>

            <div class="glass rounded-2xl p-6 relative">
                <h3 class="text-lg font-bold text-white mb-2">Satƒ±≈ü Daƒüƒ±lƒ±mƒ±</h3>
                <p class="text-xs text-gray-400 mb-6">Canlƒ± Kategori Oranlarƒ±</p>
                
                <div class="relative h-56 w-full flex justify-center items-center">
                    <canvas id="pieChart"></canvas>
                </div>
                
                <div class="mt-6 space-y-3" id="categoryLegend">
                    </div>
            </div>
        </div>

        <div class="glass rounded-2xl overflow-hidden">
            <div class="p-6 border-b border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-bold text-white">Son Sipari≈üler</h3>
                <span class="text-xs text-green-400 font-bold">‚óè Canlƒ± Akƒ±≈ü</span>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="text-gray-400 text-xs uppercase tracking-wider border-b border-gray-700 bg-black/20">
                            <th class="p-4 font-medium">Marka</th>
                            <th class="p-4 font-medium">M√º≈üteri</th>
                            <th class="p-4 font-medium">Tarih</th>
                            <th class="p-4 font-medium text-right">Toplam Adet</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody" class="text-sm text-gray-300 divide-y divide-gray-700">
                        </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        // --- AYARLAR ---
        const API_URL = "https://script.google.com/macros/s/AKfycbzybGAJd5fB6K7oO4CXtoiTYG8zhBDin1U7Q1nk0WkT5ieERPSb4lmjQMpZMQlKmZBIFw/exec";
        const USERNAME = "lutfu"; 

        // --- GRAFƒ∞K AYARLARI (Chart.js) ---
        Chart.defaults.color = '#94a3b8';
        Chart.defaults.font.family = 'Inter';

        let pieChartInstance = null; // Grafik objesini tutmak i√ßin

        // Sistemi Ba≈ülat
        window.onload = function() {
            initMainChart(); // Sabit grafiƒüi √ßiz
            fetchData();     // Canlƒ± veriyi √ßek
        };

        async function fetchData() {
            try {
                const response = await fetch(`${API_URL}?user=${USERNAME}`);
                if (!response.ok) throw new Error("Sunucu hatasƒ±");
                const data = await response.json();
                
                if(!data || data.error) throw new Error("Veri yok");
                
                updateDashboard(data);
            } catch (error) {
                console.error(error);
                document.getElementById('welcomeText').innerText = "Baƒülantƒ± Hatasƒ±!";
                document.getElementById('welcomeText').classList.add('text-red-500');
            }
        }

        function updateDashboard(data) {
            let totalShoes = 0;
            let totalTextile = 0;
            let totalAccessory = 0;
            let tableHtml = "";

            // Verileri i≈üle
            data.slice().reverse().forEach(order => {
                const s = Number(order.ayakkabi || 0);
                const t = Number(order.tekstil || 0);
                const a = Number(order.aksesuar || 0);
                const totalRow = s + t + a;

                totalShoes += s;
                totalTextile += t;
                totalAccessory += a;

                // Tablo satƒ±rƒ± olu≈ütur
                tableHtml += `
                    <tr class="hover:bg-white/5 transition group">
                        <td class="p-4 font-mono text-gray-500 group-hover:text-primary transition uppercase">${order.marka || '-'}</td>
                        <td class="p-4 font-medium text-white">${order.musteri || 'ƒ∞simsiz'}</td>
                        <td class="p-4 text-gray-400">${order.tarih ? new Date(order.tarih).toLocaleDateString('tr-TR') : '-'}</td>
                        <td class="p-4 text-right font-bold text-white">${totalRow}</td>
                    </tr>
                `;
            });

            // 1. KPI Kartlarƒ±nƒ± G√ºncelle
            document.getElementById('welcomeText').innerText = `Ho≈ügeldin, ${USERNAME.toUpperCase()} üëã`;
            document.getElementById('kpiTotalItems').innerText = totalShoes + totalTextile + totalAccessory;
            document.getElementById('kpiShoes').innerText = totalShoes;
            document.getElementById('kpiTextile').innerText = totalTextile;
            document.getElementById('kpiAccessory').innerText = totalAccessory;

            // 2. Tabloyu G√ºncelle
            document.getElementById('ordersTableBody').innerHTML = tableHtml || '<tr><td colspan="4" class="p-4 text-center">Veri yok</td></tr>';

            // 3. Pasta Grafiƒüini √áiz (Canlƒ± Veriyle)
            updatePieChart(totalShoes, totalTextile, totalAccessory);
        }

        function updatePieChart(shoes, textile, accessory) {
            const ctxPie = document.getElementById('pieChart').getContext('2d');
            
            if(pieChartInstance) {
                pieChartInstance.destroy();
            }

            pieChartInstance = new Chart(ctxPie, {
                type: 'doughnut',
                data: {
                    labels: ['Ayakkabƒ±', 'Tekstil', 'Aksesuar'],
                    datasets: [{
                        data: [shoes, textile, accessory],
                        backgroundColor: ['#3b82f6', '#fbbf24', '#a855f7'],
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '75%',
                    plugins: { legend: { display: false } }
                }
            });

            // Legend G√ºncelle
            const legendHtml = `
                <div class="flex justify-between items-center text-sm">
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-blue-500"></span><span class="text-gray-300">Ayakkabƒ±</span></div>
                    <span class="font-bold text-white">${shoes}</span>
                </div>
                <div class="flex justify-between items-center text-sm">
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-yellow-400"></span><span class="text-gray-300">Tekstil</span></div>
                    <span class="font-bold text-white">${textile}</span>
                </div>
                <div class="flex justify-between items-center text-sm">
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-purple-500"></span><span class="text-gray-300">Aksesuar</span></div>
                    <span class="font-bold text-white">${accessory}</span>
                </div>
            `;
            document.getElementById('categoryLegend').innerHTML = legendHtml;
        }

        // --- SABƒ∞T GRAFƒ∞K (G√ñRSELLƒ∞K BOZULMASIN Dƒ∞YE) ---
        function initMainChart() {
            const ctxMain = document.getElementById('mainChart').getContext('2d');
            let gradientPrimary = ctxMain.createLinearGradient(0, 0, 0, 400);
            gradientPrimary.addColorStop(0, 'rgba(251, 191, 36, 0.5)');
            gradientPrimary.addColorStop(1, 'rgba(251, 191, 36, 0.0)');

            new Chart(ctxMain, {
                type: 'line',
                data: {
                    labels: ['Pzt', 'Sal', '√áar', 'Per', 'Cum', 'Cmt', 'Paz'],
                    datasets: [{
                        label: 'Haftalƒ±k Trend',
                        data: [12, 19, 3, 5, 2, 3, 10], // Temsili veri
                        borderColor: '#fbbf24',
                        backgroundColor: gradientPrimary,
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#fbbf24',
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { color: 'rgba(255, 255, 255, 0.05)' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }
    </script>
</body>
</html>